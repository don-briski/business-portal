<section *ngIf="!isInitializing" class="card p-5">
  <header class="d-flex justify-content-between align-items-center">
    <div>
      <h1>Investment Type Setup</h1>
      <p>Kindly fill in all information correctly. All form fields with an asterisk(*) are mandatory.</p>
    </div>

    <a
      class="btn btn-primary mr-2 text-white"
      [style.borderColor]="currentTheme?.secondaryColor"
      [style.backgroundColor]="currentTheme?.secondaryColor"
      [routerLink]="['/configurations/investment-types']"
      routerLinkActive="router-link-active"
      href="javascript:void(0)"
      >Back</a
    >
  </header>

  <div class="d-flex align-items-center my-4">
    <lnd-switch
      [value]="invTypeForm.get('status').value === 'Active' ? true : false"
      text="Investment Type is currently"
      (emittedValue)="toggleSwitch($event,'status')"
    ></lnd-switch>
    <span
      class="ml-1"
      [ngClass]="
        invTypeForm.get('status').value === 'Active' ? 'text-success' : 'text-danger'
      "
      >{{ invTypeForm.get("status").value === 'Active' ? "Active" : "Inactive" }}</span
    >
  </div>

  <div class="my-6">
    <lnd-stepper [steps]="steps" [currentStepStroke]="currentTheme.primaryColor" (stepIndex)="switchStep($event)"></lnd-stepper>
  </div>

  <form [formGroup]="invTypeForm" (ngSubmit)="submit()" class="mt-6 px-4">
    <ng-container formGroupName="invDetails">
      <section [ngClass]="{ 'd-none': currentStepIndex !== 0 }">
        <header>
          <h1>Details</h1>
          <p>Set up basic investment details to control investment types and categories.</p>
        </header>
        <div class="form-row">
          <div class="col-sm-8">
            <label for="invName"
              >Investment name <b class="help-block"> *</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="This will be used to
                  identify the investment type."
                ></i>
              </span>
            </label>
            <input
              id="invName"
              type="text"
              formControlName="investmentName"
              class="form-control"
              placeholder="Name of the Investment"
            />
            <span
              class="help-block"
              *ngIf="
                invTypeForm.get('invDetails.investmentName').errors &&
                invTypeForm.get('invDetails.investmentName').touched
              "
            >
              What is name of this investment?
            </span>
          </div>

          <div class="col-sm-4">
            <label for="invCode"
              >Investment Code <b class="help-block"> *</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="This code is generated by the system and matched to this investment type."
                ></i>
              </span>
            </label>
            <input
              id="invCode"
              type="text"
              formControlName="investmentCode"
              class="form-control"
              placeholder="E.g INV00123"
            />
            <span
              class="help-block"
              *ngIf="
                invTypeForm.get('invDetails.investmentCode').errors &&
                invTypeForm.get('invDetails.investmentCode').touched
              "
            >
              What is the investment code?
            </span>
          </div>
        </div>
      </section>
    </ng-container>

    <ng-container formGroupName="fees">
      <section [ngClass]="{ 'd-none': currentStepIndex !== 1 }">
        <header>
          <h1>Fees</h1>
          <p>Set up extra fees where necessary</p>
        </header>

        <div class="form-row">
          <div class="col-sm-3">
            <label for="wht">Withholding Tax Value <b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="Set an amount to be deducted from the interest"
                ></i>
              </span>
            </label>
            <div class="input-group">
            <input
              type="number"
              formControlName="withHoldingTax"
              class="form-control"
              id="wht"
              placeholder="Enter withholding tax value"
            />
            <div class="input-group-append">
              <span class="input-group-text">%</span>
            </div>
            </div>
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('fees.withHoldingTax').errors &&
                invTypeForm.get('fees.withHoldingTax').touched
              "
            >
              <span
                *ngIf="
                  invTypeForm.get('fees.withHoldingTax').getError('required')
                "
                >What is the with holding tax value of this investment?</span
              >
              {{
                invTypeForm.get("fees.withHoldingTax").getError(
                  "LesserThanZero"
                )
              }}
            </span>
          </div>

          <div class="col-sm-3">
            <label for="penalcharge"
              >Penal Charge <b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="These charges are applied when investors liquidate investments before their maturity date."
                ></i>
              </span>
              </label
            >
            <div class="input-group">
              <input
                type="number"
                formControlName="penalCharge"
                class="form-control"
                id="penalcharge"
                placeholder="Enter penal charge"
              />
              <div class="input-group-append">
                <span class="input-group-text">%</span>
              </div>
            </div>
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('fees.penalCharge').errors &&
                invTypeForm.get('fees.penalCharge').touched
              "
            >
              <span
                *ngIf="
                  invTypeForm.get('fees.penalCharge').getError('required')
                "
                >What is the penal charge?</span
              >
              {{
                invTypeForm.get("fees.penalCharge").getError("LesserThanZero")
              }}
            </span>
          </div>
        </div>
      </section>
    </ng-container>

    <ng-container formGroupName="parameters">
      <section [ngClass]="{ 'd-none': currentStepIndex !== 2 }">
        <header>
          <h1>Parameters</h1>
          <p>Customise your rates, units and amounts to fit the investment types.</p>
        </header>

        <div class="form-row">
          <div class="col-sm-3 mb-6">
            <label for="minamount"
              >Minimum Amount <b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="Minimum amount that can be invested in this investment type. Customer cannot invest an amount less than this."
                ></i>
              </span>
              </label
            >
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">&#x20a6;</span>
              </div>
              <input
                type="text"
                currencyMask
                [options]="{ prefix: '', thousands: ',', decimal: '.' }"
                formControlName="minAmount"
                class="form-control"
                id="minamount"
                placeholder="Minimum investment amount"
              />
            </div>
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('parameters.minAmount').errors &&
                invTypeForm.get('parameters.minAmount').touched
              "
            >
              <span
                *ngIf="invTypeForm.get('parameters.minAmount').getError('required')"
                >What is the minimum amount allowed for this investment?</span
              >
              {{
                invTypeForm.get("parameters.minAmount").getError("zeroValue")
              }}
            </span>
          </div>

          <div class="col-sm-3 mb-6">
            <label for="maxamount"
              >Max Amount <b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="Maximum amount that can be invested in this investment type. Customer cannot invest an amount more than this."
                ></i>
              </span>
              </label
            >
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">&#x20a6;</span>
              </div>
              <input
                type="text"
                currencyMask
                [options]="{ prefix: '', thousands: ',', decimal: '.' }"
                formControlName="maxAmount"
                class="form-control"
                id="maxamount"
                placeholder="Maximum investment amount"
              />
            </div>
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('parameters.maxAmount').errors &&
                invTypeForm.get('parameters.maxAmount').touched
              "
            >
              <span
                *ngIf="invTypeForm.get('parameters.maxAmount').getError('required')"
                >What is the maximum amount allowed for this investment?</span
              >
              {{
                invTypeForm.get("parameters.maxAmount").getError("zeroValue")
              }}
            </span>
          </div>

          <div class="col-sm-3 mb-6">
            <label for="netinterest"
              >Minimum Interest Rate<b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="Minimum interest rate that can be applied when creating investment accounts for this investment type."
                ></i>
              </span>
              </label
            >
            <div class="input-group">
              <input
                type="number"
                formControlName="minNetInterest"
                class="form-control"
                id="netinterest"
                placeholder="Net interest rate"
              />
              <div class="input-group-append">
                <span class="input-group-text">%</span>
              </div>
            </div>
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('parameters.minNetInterest').errors &&
                invTypeForm.get('parameters.minNetInterest').touched
              "
            >
              <span
                *ngIf="
                  invTypeForm.get('parameters.minNetInterest').getError('required')
                "
                >Provide minimum interest rate</span
              >
              {{
                invTypeForm.get("parameters.minNetInterest").getError(
                  "LesserThanZero"
                )
              }}
            </span>
          </div>

          <div class="col-sm-3">
            <label for="netinterest"
              >Maximum Interest Rate<b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="Maximum interest rate that can be applied when creating investment accounts for this investment type."
                ></i>
              </span>
              </label
            >
            <div class="input-group">
              <input
                type="number"
                formControlName="maxNetInterest"
                class="form-control"
                id="netinterest"
                placeholder="Maximum Net interest rate"
              />
              <div class="input-group-append">
                <span class="input-group-text">%</span>
              </div>
            </div>
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('parameters.maxNetInterest').errors &&
                invTypeForm.get('parameters.maxNetInterest').touched
              "
            >
              <span
                *ngIf="
                  invTypeForm.get('parameters.maxNetInterest').getError('required')
                "
                >Provide maximum interest rate
              </span>
              {{
                invTypeForm.get("parameters.maxNetInterest").getError(
                  "zeroValue"
                )
              }}
            </span>
          </div>

          <div class="col-sm-4 mt-6">
            <label for="mintenor"
              >Minimum Investment Tenor (days)<b class="help-block">*</b>
              </label
            >
            <input
              type="number"
              formControlName="minInvestmentTenor"
              class="form-control"
              id="mintenor"
              placeholder="Enter Minimum Investment Tenor"
            />
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('parameters.minInvestmentTenor').errors &&
                invTypeForm.get('parameters.minInvestmentTenor').touched
              "
            >
              <span
                *ngIf="
                  invTypeForm.get('parameters.minInvestmentTenor').getError(
                    'required'
                  )
                "
                >Provide minimum investment tenor
              </span>
              {{
                invTypeForm.get("parameters.minInvestmentTenor").getError(
                  "zeroValue"
                )
              }}
            </span>
          </div>

          <div class="col-sm-4 mt-6">
            <label for="maxtenor"
              >Maximum Investment Tenor (days)<b class="help-block">*</b>
              </label
            >
            <input
              type="number"
              formControlName="maxInvestmentTenor"
              class="form-control"
              id="maxtenor"
              placeholder="Enter Maximum Investment Tenor"
            />
            <span
              class="help-block"
              [style.color]="currentTheme?.secondaryColor"
              *ngIf="
                invTypeForm.get('parameters.maxInvestmentTenor').errors &&
                invTypeForm.get('parameters.maxInvestmentTenor').touched
              "
            >
              <span
                *ngIf="
                  invTypeForm.get('parameters.maxInvestmentTenor').getError(
                    'required'
                  )
                "
                >What is the maximum investment tenor?</span
              >
              {{
                invTypeForm.get("parameters.maxInvestmentTenor").getError(
                  "zeroValue"
                )
              }}
            </span>
          </div>

          <div class="col-sm-4 mt-6">
            <label for="interestratetype"
              >Interest Rate Type <b class="help-block">*</b>
              <span>
                <i
                  class="icon icon-question-circle icon-fw icon-xl"
                  placement="top"
                  ngbTooltip="How interests are accrued."
                ></i>
              </span>
              </label
            >
            <div>
              <slct-2
              [data]="interestRateTypes"
              formControlName="interestRate"
              placeholder="Select Interest Type"
            ></slct-2>
              <span
                class="help-block"
                [style.color]="currentTheme?.secondaryColor"
                *ngIf="
                  invTypeForm.get('parameters.interestRateType').errors &&
                  invTypeForm.get('parameters.interestRateType').touched
                "
              >
                Select interest type
              </span>
            </div>
          </div>

        </div>
      </section>
    </ng-container>
    <ng-container formGroupName="certificate">
      <section [ngClass]="{ 'd-none': currentStepIndex !== 3 }">
        <header>
          <h1>Certificate Setup</h1>
          <p>Customise terms and conditions on certificate.</p>
        </header>
        <div>
          <label
            >Terms & Conditions
            <lnd-tooltip text="Set the terms that apply to this investment agreement."></lnd-tooltip>
          </label>
          <div class="d-flex align-items-center my-4">
            <lnd-switch
              [value]="invTypeForm.get('certificate.displayTermsAndConditions').value ? true : false"
              text="Show terms and conditions on certificate"
              (emittedValue)="toggleSwitch($event,'certificate')"
            ></lnd-switch>
          </div>
          <div formArrayName="termsAndConditions" class="row">
            <ol
              class="mb-2 col-md-7"
              *ngFor="
                let ctrl of termsAndConditions.controls;
                let lineIndex = index
              "
              type="i"
              [start]="lineIndex + 1"
            >
              <li>
                <div class="d-flex align-items-center" [formGroup]="ctrl">
                  <textarea
                    formControlName="description"
                    class="form-control"
                    rows="2"
                  ></textarea>
                  <span
                    *ngIf="termsAndConditions.controls.length > 0"
                    class="remove-btn ml-3 pointer"
                    (click)="onRemoveTAndC(lineIndex)"
                  >
                    <i class="icon icon-trash icon-lg"></i>
                  </span>
                </div>
              </li>
              <lnd-input-errors
                label="Field"
                [control]="ctrl"
              ></lnd-input-errors>
            </ol>
          </div>
          <button
            *ngIf="termsAndConditions.controls.length < 5"
            type="button"
            [style.backgroundColor]="currentTheme?.primaryColor"
            [style.border]="currentTheme?.primaryColor"
            (click)="addToTAndC()"
            class="btn btn-xs btn-success d-flex align-items-center py-1"
          >
            <i class="icon icon-add mr-1"></i><span>Add New</span>
          </button>
        </div>
      </section>
    </ng-container>
    <div class="d-flex align-items-center my-4">
      <lnd-switch
        [value]="invTypeForm.get('approvalRequired').value ? true : false"
        text="Requires Approval ?"
        (emittedValue)="toggleSwitch($event,'approval')"
      ></lnd-switch>
    </div>
    <lnd-step-footer [formValid]="invTypeForm.valid" [isLoading]="isLoading" [currentTheme]="currentTheme" [currentStepIndex]="currentStepIndex" [steps]="steps" [currentStepIsValid]="invTypeForm.get(steps[currentStepIndex].id)?.valid" (previous)="previous()" (next)="next()"></lnd-step-footer>
  </form>
</section>
